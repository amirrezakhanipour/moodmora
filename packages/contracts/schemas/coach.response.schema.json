{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "moodmora://schemas/coach.response.schema.json",
  "title": "CoachResponseData",
  "type": "object",
  "additionalProperties": false,
  "required": ["assistant_message", "action_steps", "best_next_message"],
  "properties": {
    "assistant_message": { "type": "string", "minLength": 1, "maxLength": 12000 },

    "action_steps": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "items": { "type": "string", "minLength": 1, "maxLength": 4000 }
    },

    "best_next_message": { "type": "string", "minLength": 1, "maxLength": 12000 },

    "best_question": { "type": "string", "minLength": 1, "maxLength": 2000 },
    "safety_line": { "type": "string", "minLength": 1, "maxLength": 2000 },

    "risk": {
      "type": "object",
      "additionalProperties": false,
      "required": ["level", "score", "reasons"],
      "properties": {
        "level": { "type": "string", "enum": ["low", "medium", "high"] },
        "score": { "type": "number", "minimum": 0, "maximum": 1 },
        "reasons": {
          "type": "array",
          "maxItems": 6,
          "items": { "type": "string", "minLength": 1, "maxLength": 400 }
        }
      }
    },

    "ui_hints": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "collapse_context_card": { "type": "boolean" },
        "show_pinned_summary": { "type": "boolean" }
      }
    }
  }
}